{% load static %}

<!-- Login Modal -->
<div id="login-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 flex items-center justify-center">
  <div class="bg-white/95 backdrop-blur-md shadow-2xl rounded-2xl p-8 w-full max-w-md mx-4 border border-slate-200 relative">

    <!-- Close Button -->
    <button id="close-login" class="absolute top-3 right-3 text-gray-500 hover:text-rose-700 text-xl font-bold">&times;</button>

    <!-- Header -->
    <div class="text-center mb-6">
      <h2 class="text-2xl font-bold text-rose-700">LOGIN</h2>
    </div>

    <!-- Alerts -->
    <div id="error-alert" class="hidden bg-red-100 text-red-800 text-sm px-4 py-3 rounded-md mb-3"></div>
    <div id="success-alert" class="hidden bg-green-100 text-green-800 text-sm px-4 py-3 rounded-md mb-3"></div>

    <!-- Form -->
    <form id="login-form" class="space-y-4">
      {% csrf_token %}
      <input type="text" id="username" name="username"
             class="w-full border border-slate-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-rose-400 focus:outline-none"
             placeholder="Username / Email" required>

      <input type="password" id="password" name="password"
             class="w-full border border-slate-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-rose-400 focus:outline-none"
             placeholder="Password" required>

      <button type="submit"
              class="w-full bg-rose-600 text-white py-2 rounded-md font-semibold hover:bg-rose-700 transition-all duration-300">
        SUBMIT
      </button>
    </form>

    <div class="text-center mt-4 text-sm text-slate-700">
      Belum punya akun?
      <a href="{% url 'authenticate:register' %}" class="text-rose-600 font-semibold hover:text-rose-700 transition">
        Daftar
      </a>
    </div>
  </div>
</div>

<!-- Script -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("login-modal");
  const closeBtn = document.getElementById("close-login");
  const form = document.getElementById("login-form");
  const errorAlert = document.getElementById("error-alert");
  const successAlert = document.getElementById("success-alert");

  // Fungsi buka/tutup modal
  window.openLoginModal = () => modal.classList.remove("hidden");
  closeBtn.addEventListener("click", () => modal.classList.add("hidden"));
  window.addEventListener("click", (e) => {
    if (e.target === modal) modal.classList.add("hidden");
  });

  // Form submit
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    try {
      const response = await fetch("{% url 'authenticate:login' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
          username: username,
          password: password
        }),
      });

      if (response.ok) {
        successAlert.textContent = "Login berhasil! Mengalihkan...";
        successAlert.classList.remove("hidden");
        errorAlert.classList.add("hidden");
        setTimeout(() => {
          window.location.href = "{% url 'venue:home_section' %}";
        }, 1500);
      } else {
        const data = await response.json();
        errorAlert.textContent = data.message || "Login gagal. Silakan coba lagi.";
        errorAlert.classList.remove("hidden");
        successAlert.classList.add("hidden");
      }
    } catch (err) {
      errorAlert.textContent = "Terjadi kesalahan jaringan.";
      errorAlert.classList.remove("hidden");
      successAlert.classList.add("hidden");
    }
  });
});
</script>