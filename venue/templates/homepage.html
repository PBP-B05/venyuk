<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VenYuk! - Find Your Perfect Venue</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --dark: #1D1616;
            --primary: #8E1616;
            --secondary: #D84040;
            --light: #EEEEEE;
        }

        body {
            background-color: var(--light);
            min-height: 100vh;
        }

        .navbar {
            background-color: var(--dark);
            padding: 1rem 0;
        }

        .hero-banner {
            background: linear-gradient(rgba(29, 22, 22, 0.7), rgba(142, 22, 22, 0.7)), 
                        url('/static/banner.jpg') no-repeat center center;
            background-size: cover;
            height: 60vh;
            display: flex;
            align-items: center;
            color: white;
            text-align: center;
        }

        .hero-banner h1 {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .filter-section {
            background-color: var(--primary);
            padding: 1.5rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .form-control, .form-select {
            border: 1px solid var(--dark);
            border-radius: 5px;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 0.2rem rgba(216, 64, 64, 0.25);
        }

        .btn-primary {
            background-color: var(--secondary);
            border-color: var(--secondary);
            padding: 0.5rem 1.5rem;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }

        .venue-card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            margin-bottom: 2rem;
        }

        .venue-card:hover {
            transform: translateY(-5px);
        }

        .venue-card img {
            height: 200px;
            object-fit: cover;
        }

        .card-body {
            padding: 1.5rem;
        }

        .badge {
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">VenYuk!</a>
            <div class="d-flex">
                <a href="/authenticate/login/" class="btn btn-primary">Masuk</a>
            </div>
        </div>
    </nav>

    <!-- Hero Banner -->
    <div class="hero-banner">
        <div class="container">
            <h1>BOOKING VENUE di VenYuk!</h1>
            <p class="lead mb-4">Temukan dan booking venue olahraga terbaik dengan mudah</p>
            <a href="#venues" class="btn btn-primary btn-lg">BOOKING SEKARANG!</a>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="container">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" id="search" class="form-control" placeholder="Cari venue...">
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="category">
                        <option value="">Semua Kategori</option>
                        {% for key, value in categories.items %}
                            <option value="{{ key }}">{{ value }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" placeholder="Min Price" id="min_price">
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" placeholder="Max Price" id="max_price">
                </div>
                <div class="col-md-1">
                    <button class="btn btn-light w-100" onclick="filterVenues()">Filter</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Venues Section -->
    <div class="container py-5" id="venues">
        {% if venues %}
            <div class="row g-4" id="venues-container">
                {% for venue in venues %}
                <div class="col-md-4">
                    <div class="venue-card card">
                        <img src="{{ venue.thumbnail.url|default:'/static/default-venue.jpg' }}" 
                             class="card-img-top" 
                             alt="{{ venue.name }}">
                        <div class="card-body">
                            <h5 class="card-title fw-bold">{{ venue.name }}</h5>
                            <div class="mb-3">
                                <span class="badge bg-primary">{{ venue.get_category_display }}</span>
                                <span class="badge bg-secondary">Rp {{ venue.price|floatformat:0 }}</span>
                            </div>
                            <p class="card-text mb-2">‚≠ê {{ venue.rating }}/5.0</p>
                            <p class="card-text small mb-3">üìç {{ venue.address }}</p>
                            <button class="btn btn-primary w-100" 
                                    onclick="bookVenue('{{ venue.id }}')"
                                    {% if not venue.is_available %}disabled{% endif %}>
                                {% if venue.is_available %}Book Now{% else %}Not Available{% endif %}
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <img src="/static/placeholder.png" alt="No Venues" class="mb-4" style="max-width: 200px; opacity: 0.5;">
                <h3 class="text-muted">Belum ada venue yang terdaftar</h3>
                <p class="text-muted">Silakan coba lagi nanti</p>
            </div>
        {% endif %}
    </div>

    <!-- Alert Messages -->
    <div class="alert alert-success" id="success-alert" role="alert"></div>
    <div class="alert alert-danger" id="error-alert" role="alert"></div>

    <script>
        function filterVenues() {
            const params = new URLSearchParams();
            
            const search = $('#search').val();
            const category = $('#category').val();
            const minPrice = $('#min_price').val();
            const maxPrice = $('#max_price').val();
            
            if (search) params.append('q', search);
            if (category) params.append('category', category);
            if (minPrice) params.append('min_price', minPrice);
            if (maxPrice) params.append('max_price', maxPrice);
            
            $.ajax({
                url: '?' + params.toString(),
                headers: {'X-Requested-With': 'XMLHttpRequest'},
                success: function(data) {
                    updateVenues(data.venues);
                }
            });
        }

        function updateVenues(venues) {
            const container = $('#venues-container');
            container.empty();
            
            venues.forEach(venue => {
                container.append(`
                    <div class="col-md-4">
                        <div class="venue-card card">
                            <img src="${venue.thumbnail || '/static/default-venue.jpg'}" 
                                 class="card-img-top" 
                                 alt="${venue.name}">
                            <div class="card-body">
                                <h5 class="card-title fw-bold">${venue.name}</h5>
                                <div class="mb-3">
                                    <span class="badge bg-primary">${venue.category}</span>
                                    <span class="badge bg-secondary">Rp ${venue.price}</span>
                                </div>
                                <p class="card-text mb-2">‚≠ê ${venue.rating}/5.0</p>
                                <p class="card-text small mb-3">üìç ${venue.address}</p>
                                <button class="btn btn-primary w-100" 
                                        onclick="bookVenue('${venue.id}')"
                                        ${!venue.is_available ? 'disabled' : ''}>
                                    ${venue.is_available ? 'Book Now' : 'Not Available'}
                                </button>
                            </div>
                        </div>
                    </div>
                `);
            });
        }

        function bookVenue(venueId) {
            $.ajax({
                url: `/venue/book-venue/${venueId}/`,
                method: 'POST',
                success: function(response) {
                    showAlert('success', 'Booking successful!');
                    setTimeout(() => location.reload(), 1500);
                },
                error: function(xhr) {
                    showAlert('error', xhr.responseJSON?.message || 'Booking failed');
                }
            });
        }

        function showAlert(type, message) {
            const alert = type === 'success' ? $('#success-alert') : $('#error-alert');
            alert.text(message).fadeIn();
            setTimeout(() => alert.fadeOut(), 3000);
        }
    </script>
</body>
</html>